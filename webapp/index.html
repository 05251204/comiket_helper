<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>ComiPath - Comiket TSP</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1><i class="fa-solid fa-route"></i> ComiPath</h1>
      <button id="toggle-settings" class="settings-btn" aria-label="設定">
        <i class="fa-solid fa-gear"></i>
      </button>
    </header>

    <div class="container">
      <!-- 設定エリア -->
      <div id="settings-area" class="card">
        <h2>設定</h2>
        <div class="input-group">
          <label for="gas-url">GAS Web App URL</label>
          <div class="input-row">
            <input
              type="text"
              id="gas-url"
              placeholder="https://script.google.com/..."
              style="text-align: left"
            />
            <button
              id="btn-refresh"
              class="btn btn-secondary"
              style="width: auto"
            >
              <i class="fa-solid fa-rotate"></i>
            </button>
          </div>
        </div>
        <p
          style="font-size: 0.8rem; color: var(--text-sub); margin-top: 0.5rem"
        >
          ※URLを入力して更新ボタンを押してください
        </p>

        <div class="input-group" style="margin-top: 1rem;">
            <label>対象シート選択</label>
            <button id="btn-fetch-sheets" class="btn btn-secondary btn-sm" style="width: auto; margin-bottom: 0.5rem;">
                <i class="fa-solid fa-list"></i> シート一覧を取得
            </button>
            <div id="sheet-list-container" class="sheet-list-container">
                <!-- シート一覧がここに生成されます -->
            </div>
        </div>
      </div>

      <!-- 現在地入力 -->
      <div class="card">
        <div class="current-location-header">
            <h2>現在地</h2>
            <div class="location-controls">
              <select id="loc-ewsn"></select>
              <select id="loc-label"></select>
              <select id="loc-number"></select>
            </div>
        </div>
        <button
          id="btn-search"
          class="btn btn-primary"
          style="margin-top: 0.5rem"
        >
          <i class="fa-solid fa-magnifying-glass"></i> 次の目的地を検索
        </button>
      </div>

      <!-- 次の目的地 -->
      <div id="next-target" class="card">
        <div id="target-loading" class="loading-overlay hidden">
          <i class="fa-solid fa-spinner fa-spin"></i> 計算中...
        </div>

        <div id="target-content" class="hidden">
          <div class="target-info-display">
            <div class="target-group-wrapper">
              <div class="target-circle-info">
                <span class="target-label">NEXT TARGET</span>
                <h1 id="target-space-heading">---</h1>
              </div>
              <div class="sub-target-info">
                <span class="sub-target-label">NEXT AFTER</span>
                <span id="sub-target-space" class="sub-target-value">---</span>
              </div>
              <a
                id="target-tweet-link"
                href="#"
                target="_blank"
                class="tweet-link"
              >
                <i class="fa-brands fa-twitter"></i> Link
              </a>
              <div class="target-meta compact">
                <span class="meta-item"
                  ><i class="fa-solid fa-person-walking"></i>
                  <span id="target-dist">-</span></span
                >
                <span class="meta-item"
                  ><i class="fa-solid fa-star"></i>
                  <span id="target-priority">-</span></span
                >
              </div>
            </div>
          </div>

          <div id="tweet-embed-container" class="tweet-preview"></div>

          <div id="target-map-container" class="map-embed-container">
             <div class="map-header">
               <span class="map-label"><i class="fa-regular fa-map"></i> MAP: <span id="map-area-name">-</span></span>
               <a id="target-map-link" href="#" target="_blank" class="map-external-link"><i class="fa-solid fa-up-right-from-square"></i></a>
             </div>
             <div id="map-image-container" class="map-image-scroll-container">
               <img id="target-map-image" alt="Map" />
             </div>
          </div>

          <div class="action-grid">
            <button id="btn-purchased" class="btn btn-success">
              <i class="fa-solid fa-check"></i> 購入済
            </button>
            <button id="btn-hold" class="btn btn-warning">
              <i class="fa-solid fa-pause"></i> 保留
            </button>
          </div>
          <div class="undo-redo-container">
            <button id="btn-undo" class="btn btn-secondary">
              <i class="fa-solid fa-rotate-left"></i> Undo
            </button>
            <button id="btn-redo" class="btn btn-secondary">
              <i class="fa-solid fa-rotate-right"></i> Redo
            </button>
          </div>
        </div>

        <div id="target-empty" class="empty-state">
          <i
            class="fa-regular fa-map"
            style="font-size: 2rem; margin-bottom: 0.5rem"
          ></i>
          <p>現在地を入力して<br />検索ボタンを押してください</p>
        </div>
      </div>

      <!-- 地図リンク -->
      <div id="map-links-container" class="map-links-grid">
        <!-- JSで動的に生成 -->
      </div>

      <!-- ステータス -->
      <div class="card compact-card">
        <div class="stats-container">
          <table class="stats-table">
            <thead>
              <tr>
                <th></th>
                <th>東4-6</th>
                <th>東7</th>
                <th>西</th>
                <th>南</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="status-label">残り</td>
                <td id="count-e456">0</td>
                <td id="count-e7">0</td>
                <td id="count-w12">0</td>
                <td id="count-s12">0</td>
              </tr>
              <tr id="btn-hold-list" class="hold-row">
                <td class="status-label warning">保留</td>
                <td id="count-hold-e456">0</td>
                <td id="count-hold-e7">0</td>
                <td id="count-hold-w12">0</td>
                <td id="count-hold-s12">0</td>
              </tr>
            </tbody>
          </table>
        </div>
        <button
          id="btn-reset-all"
          class="btn btn-danger btn-sm"
          style="margin-top: 0.5rem"
        >
          <i class="fa-solid fa-trash"></i> リセット
        </button>
      </div>
    </div>

    <div id="pdf-modal" class="pdf-modal hidden">
      <div class="pdf-modal-header">
        <button id="btn-close-pdf" class="btn-close-modal">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div class="pdf-container" id="modal-image-container">
        <img id="pdf-modal-image" alt="Map" />
      </div>
      <button id="btn-set-target" class="btn btn-primary" style="margin-top: 10px; display: none;">
        <i class="fa-solid fa-location-dot"></i> ここを目的地にする
      </button>
    </div>

    <div id="gallery-modal" class="gallery-modal hidden">
      <div class="pdf-modal-header">
        <button id="btn-close-gallery" class="btn-close-modal">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div class="gallery-grid" id="gallery-grid">
        <!-- JSで生成 -->
      </div>
    </div>

    <div id="toast"></div>

    <!-- Twitter Widgets -->
    <script
      async
      src="https://platform.twitter.com/widgets.js"
      charset="utf-8"
    ></script>

    <!-- Main Script (Module) -->
    <script type="module" src="js/app.js"></script>
  </body>
</html>
